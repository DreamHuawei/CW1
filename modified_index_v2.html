<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://unpkg.com/vue@2"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="css/css.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.16.2/axios.js"></script>
    <title>Mobile App</title>
</head>

<body>
    <div class="range">
        <div id="app">
        <header>
            <div class="navbar navbar-default" style=" background-color: bisque;">
                <div class="navbar-header ">
                    <h1>{{ sitename }}</h1>
                </div>
                                
                <div class="nav navbar-nav navbar-right cart">
                    <button type="button" v-model="showCart" class="btn btn-default btn-lg" v-on:click="showCheckout" style="position: relative;  left: 27%;" v-if="">
                        <span class="glyphicon glyphicon-shopping-cart">{{ cartItemCount}}</span> Checkout
                    </button>
                    <button disabled="true" type="button" class="btn btn-default btn-lg" style="position: relative;  left: 27%;" v-else>
                        <span class="glyphicon glyphicon-shopping-cart">{{ cartItemCount}}</span> Checkout
                    </button>
                    <div class="searchBox">
                        <input type="text" v-model="searchContent"  placeholder="Search box">
                    </div>
                </div>
                <div class="sort">
                    <div class="col-md-8 boxes">
                        <input type="radio" name="sort" value="asc" v-model="titleSort" >
                        <label >titleAsc</label>
                        <input type="radio" name="sort" value="desc" v-model="titleSort" >
                        <label >titleDesc</label>
                    </div>
                </div>
            </div>
        </header>
        <main>
            <div v-if="showProduct" class="restrict">
            <div v-for="product in sortedProducts" style="width: 33.33%;">
                <div >
                <div style="float: left; margin-right: 10px;">
                    <figure>
                        <img class="product" v-bind:src="product.image">
                    </figure>
                </div>
                <div class="description">
                    <h1 v-text="product.title" style="font-size: 25px; font-weight: bold;"></h1>
                    <p v-html="product.location"></p>
                    <p class="price">{{product.price | formatPrice}}</p>
                    <button class=" btn btn-primary btn-lg" v-on:click="addToCart(product)" v-if="canAddToCart(product)">
                        Add to cart
                    </button>
                    <button disabled="true" class=" btn btn-primary btn-lg" v-else>
                        Add to cart
                    </button>
                    <span class="inventory-message" v-if="product.availableInventory - cartCount(product.id) === 0">
                        All Out!
                    </span>
                    <span class="inventory-message" v-else-if="product.availableInventory - cartCount(product.id) < 5">
                        Only {{product.availableInventory - cartCount(product.id)}} left!
                    </span>
                    <span class="inventory-message" v-else>
                        Buy Now!
                    </span>
                    
                    <div class="rating">
                        <span v-bind:class="{'rating-active' :checkRating(n, product)}" v-for="n in 5">
                            ☆
                        </span>
                    </div>
                </div>
                </div>
            </div>
            </div>
            <div v-else>
            <div class="row">
                <div class="col-md-5 col-md-offset-7">
                <div class="panel panel-info">
                    <div class="panel-heading">Course Checkout</div>
                    <div class="panel-body">
                    <div class="form-group">
                        <div class="col-md-12">
                        <h4>
                            <strong>Enter Your Information</strong>
                        </h4>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-6">
                            <strong>First Name:</strong>
                            <input v-model.trim="order.firstName" class="form-control" />
                        </div>
                        <div class="col-md-6">
                            <strong>Last Name:</strong>
                            <input v-model.trim="order.lastName" class="form-control" />
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-12">
                            <strong>Phone number:</strong>
                            </div>
                            <div class="col-md-12">
                            <input v-model.trim="order.number" class="form-control" />
                        </div>
                    </div>
                    
                    <div class="col-md-12 verify">
                        <pre>
                            First Name: {{order.firstName}}
                            Last Name: {{order.lastName}}
                            Phone number: {{order.number}}
                            
                        </pre>
                    </div>

                    <div class="form-group submitCourse">
                        <div class="col-md-3">
                            <button disabled="true" class="" v-if="isSubmitDisabled">Submit</button>
                            <button class="" v-on:click="submitForm" v-else>Submit</button>
                        </div>
                    </div>
                    <!-- end of col-md-12 verify-->
                    </div>
                    <!--end of panel-body-->
                </div>
                <!--end of panel panel-info-->
                </div>
                <!--end of col-md-10 col-md-offset-1-->
            </div>
            <!--end of row-->
            </div>
        </main>
        </div>
        <!-- end of app-->
    </div>

    <script type="text/javascript">
        
        var APP_LOG_LIFECYCLE_EVENTS = true;
        var webstore = new Vue({
        el: '#app',
        data: {
            sitename: "Course Selection System",
            showProduct: true,
            
            order: {
              firstName: '',
              lastName: '',
              number: '',
            },
            products: {},
            cart: [],
            titleSort: "asc",
            searchContent: "",
            
        },
        

        methods: {
            checkName(){
                if(order.firstName == ""){

                }
            },
            checkRating(n, myProducts) {
            return myProducts.rating - n >= 0;
            },
            
            addToCart(aProduct) {
            this.cart.push(aProduct.id);
            },
            
            cartCount(id) {
            let count = 0;
            for (var i = 0; i < this.cart.length; i++) {
                if (this.cart[i] === id) {
                count++;
                }
            }
            return count;
            },
            
            canAddToCart(aProduct) {
            return aProduct.availableInventory > this.cartCount(aProduct.id);
            },


            showCheckout() {
            this.showProduct = this.showProduct ? false : true;
            },

            submitForm() {
            alert('Submit Successfully');
            },

            // checkInput(firstName, lastName, number) {
            //     const nameRegex = /^[a-zA-Z]+$/;
            //     const phoneRegex = /^[0-9]+$/;
            //     if(this.firstName !=nameRegex){

            //     }
            //     return firstName.match(nameRegex) && lastName.match(nameRegex) && number.match(phoneRegex);
            // },
        },

        computed: {
            isSubmitDisabled: function() {
            return !this.order.firstName || !this.order.lastName || !this.order.number;
        },
            cartItemCount() {
                return this.cart.length || '';
            },
            sortedProducts() {
            if (this.products.length > 0) {
                let productsArray = this.products.slice(0);
                console.log(productsArray);
                console.log(this.products);
                if(this.searchContent !== ""){
                    productsArray = productsArray.filter(product=>product.title.toLowerCase().includes(this.searchContent.toLowerCase()))
                }
                    if(this.titleSort === "asc"){
                    return productsArray.sort(compare);
                } else {
                    return productsArray.sort(compareDesc);
                }
        
                function compare(a, b) {
                if (a.title.toLowerCase() < b.title.toLowerCase())
                    return -1;
                if (a.title.toLowerCase() > b.title.toLowerCase())
                    return 1;
                return 0;
                }
                function compareDesc(a, b) {
                if (a.title.toLowerCase() < b.title.toLowerCase())
                    return 1;
                if (a.title.toLowerCase() > b.title.toLowerCase())
                    return -1;
                return 0;
                }
            }

            },

            // checkInput(firstName, lastName, number) {
            //     return name.match(nameRegex) && phone.match(phoneRegex);
            // },
        },
        

        //价格计算规则开始
        filters: {
            formatPrice(price) {
                if (!parseInt(price)) { return ""; }
                if (price > 99999) {
                    var priceString = (price / 100).toFixed(2);	
                    var priceArray = priceString.split("").reverse();	
                    var index = 3;
                    while (priceArray.length > index + 3) {	
                    priceArray.splice(index+3, 0, ",");	
                    index += 4;	
                    }
                    return "$" + priceArray.reverse().join("");	
                }
                else {
                    return "$" + (price / 100).toFixed(2);
                }
            }
          },
          //价格计算规则结束

          //记录和控制app生命周期改变前后的事件
          beforeCreate: function () {	
            if (APP_LOG_LIFECYCLE_EVENTS) {	
            console.log("beforeCreate");	
            }
            },	
            created: function () {	
                axios.get('./productsData.json')
                .then((response) => {
                    this.products = response.data.products;
                    console.log(this.products);
                });
            },	
            beforeMount: function () {	
                if (APP_LOG_LIFECYCLE_EVENTS) {	
                console.log(" beforeMount");	
                }
            },	
            mounted: function () {	
                if (APP_LOG_LIFECYCLE_EVENTS) {	
                console.log(" mounted"); 
                }
            },
            beforeUpdate: function () { 
                if (APP_LOG_LIFECYCLE_EVENTS) { 
                console.log("beforeUpdate"); 
                } 
            },
            updated: function () { 
                if (APP_LOG_LIFECYCLE_EVENTS) { 
                console.log("updated"); 
                } 
            },
            beforeDestroyed: function () { 
                if (APP_LOG_LIFECYCLE_EVENTS) { 
                console.log("beforeDestroyed "); 
                } 
            },
            destroyed: function () {
                if (APP_LOG_LIFECYCLE_EVENTS) {
                console.log("destroyed"); 
                } 
            }
        });
    </script>
</body>

</html>